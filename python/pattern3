duplicate_model = copyModel(model)
addParam(model,"theta")
formode m = model.modes {
    m_copy = model.addState(, m)
    m_copy.replace(flow,"ngps","nenc")
    model.addTransition(m,m_copy,"abs(ngps-nenc) > theta")
    model.addTransition(m_copy,m,"abs(ngps-nenc) < theta")
}

fortran t = duplicate_model.transitions {
    src = t.source
    dst = t.destination
    copy_src = getCopyState(model,src)
    copy_dst = getCopyState(model,dst)
    model.addTransition(copy_src, copy_dst,t.guard)
}
